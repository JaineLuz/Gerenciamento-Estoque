<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Login</title>
    <link rel="stylesheet" href="public/js/css/style.css">
</head>

<body>
    <div id="usuarioModal" class="login-container">
        <h2>Login</h2>
        <form id="form-login">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="text" name="username" class="form-control" id="email" aria-describedby="emailHelp"
                    placeholder="Digite seu email">
                <small id="emailHelp" class="form-text">We'll never share your email with anyone else.</small>
            </div>
            <div class="form-group">
                <label for="senha">Senha:</label>
                <input type="password" name="senha" class="form-control" id="senha" placeholder="Digite sua senha">
            </div>
            <div class="form-group form-check">
                <input type="checkbox" name="lembrarSenha" class="form-check-input" id="exampleCheck1">
                <label class="form-check-label" for="exampleCheck1">Lembrar senha</label>
            </div>
            <button id="entrar" type="submit" class="btn btn-primary btn-block">Entrar</button>
        </form>

    </div>

    <script>
        /*const button = document.getElementById('entrar');
        button.addEventListener('click', async () => { // Tornar a função assíncrona
            e.preventDefault();
            const email = document.querySelector('#username').value;
            const senha = document.querySelector('#senha').value;

            try {
                const response = await fetch('http://localhost:3000/login', { // Usando 'await' para esperar a resposta
                    method: 'POST', // Alterado para 'POST' para enviar os dados
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, senha }), // Enviando os dados de login
                });

                const data = await response.json(); // Usando 'await' para obter o JSON da resposta

                if (response.ok) {
                    const superUsuarios = data.superUsuarios; // Alterado para superUsuarios, conforme sua tabela

                    // Verificando se o usuário existe
                    const usuario = superUsuarios.find(user => user.email === email && user.senha === senha);

                    if (usuario) {
                        // Se o usuário for encontrado, redireciona para o estoque
                        window.location.href = "estoque.html";
                    } else {
                        // Se o usuário não for encontrado, exibe uma mensagem e redireciona para login
                        const errorMessage = document.getElementById('error-message');
                        errorMessage.style.display = 'block';
                        errorMessage.textContent = "Usuário não encontrado. Redirecionando para login...";

                        setTimeout(() => {
                            window.location.href = "login.html";
                        }, 5000);
                    }
                } else {
                    console.error('Erro ao buscar superUsuarios:', response.status);
                    alert('Erro ao buscar superUsuarios. Tente novamente mais tarde.');
                }
            } catch (error) {
                console.error('Erro na requisição:', error);
                alert('Erro ao conectar ao servidor. Tente novamente mais tarde.');
            }
        });

*/

        /*const urlParams = new URLSearchParams(window.location.search);
        const erro = urlParams.get('erro');
        if (erro) {
            alert('Erro ao logar');
        }*/

        //Adicionar superusuario
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('#form-login');

            // const successToast = new bootstrap.Toast(document.getElementById('successToast'));


            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const email = document.querySelector('#email').value;
                const senha = document.querySelector('#senha').value;

                try {
                    const response = await fetch('http://localhost:3000/login', { // Usando 'await' para esperar a resposta
                        method: 'POST', // Alterado para 'POST' para enviar os dados
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email, senha }),// Enviando os dados de login

                    });
                    console.log("Resposta do servidor:", response);
                    const data = await response.json();


                    if (response.ok) {
                        const superUsuario = data.superUsuario;


                        // Verificando se o usuário existe
                        const usuario = superUsuario.find(usuario => usuario.email === email && usuario.senha === senha);

                        if (usuario) {
                            // Se o usuário for encontrado, redireciona para o estoque
                            window.location.href = "estoque.html";
                        } else {
                            // Se o usuário não for encontrado, exibe uma mensagem e redireciona para login
                            const errorMessage = document.getElementById('error-message');
                            errorMessage.style.display = 'block';
                            errorMessage.textContent = "Usuário não encontrado. Redirecionando para login...";

                            setTimeout(() => {
                                window.location.href = "login.html";
                            }, 5000);
                        }
                    } else {
                        console.error('Erro ao buscar superUsuarios:', response.status);
                        alert('Erro ao buscar superUsuarios. Tente novamente mais tarde.');
                    }
                } catch (error) {
                    console.error('Erro na requisição:', error);
                    alert('Erro ao conectar ao servidor. Tente novamente mais tarde.');
                }
            });
        });


        // Adicionar superusuario
        function abrirFormulario() {
            const modal = new bootstrap.Modal(document.getElementById('usuarioModal'));
            document.getElementById('form-login').reset();
            modal.show();
        }

        /*document.getElementById('form-login').addEventListener('submit', (e) => {
            e.preventDefault();
            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;

            superusuarios.push({ nome, email, senha });

            const modal = bootstrap.Modal.getInstance(document.getElementById('produtoModal'));
            modal.hide();
        });
*/
        /* Editar produto
        function editarProduto(index) {
            const produto = produtos[index];

            // Preencher o formulário com os dados do produto
            document.getElementById('nome').value = produto.nome;
            document.getElementById('descricao').value = produto.descricao;
            document.getElementById('categoria').value = produto.categoria;
            document.getElementById('quantidade').value = produto.quantidade;
            document.getElementById('valorUnitario').value = produto.valorUnitario;

            // Abrir o modal do formulário
            abrirFormulario();

            // Atualizar a função de envio do formulário
            const form = document.getElementById('form-produto');

            // Remover event listeners duplicados
            const novoForm = form.cloneNode(true);
            form.replaceWith(novoForm);

            // Associar o evento atualizado
            novoForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // Atualizar o produto no array
                produtos[index] = {
                    nome: novoForm.querySelector('#nome').value,
                    descricao: novoForm.querySelector('#descricao').value,
                    categoria: novoForm.querySelector('#categoria').value,
                    quantidade: parseInt(novoForm.querySelector('#quantidade').value),
                    valorUnitario: parseFloat(novoForm.querySelector('#valorUnitario').value),
                };

                // Recarregar a tabela de produtos
                carregarProdutos();

                // Fechar o modal
                bootstrap.Modal.getInstance(document.getElementById('produtoModal')).hide();
            });
        }*/
    </script>
</body>

</html>